<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>관리자 - 게시글 수정</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/border-write.css" />
</head>
<body>
<header>
    <div th:replace="~{fragments/header :: header}"></div>
</header>

<div class="write-container">
    <h2>게시글 수정</h2>
    <p class="info-text">관리자는 게시글 정보를 수정할 수 있습니다.</p>

    <form th:action="@{'/admin/boards/edit/' + ${board.id} +
                  '?page=' + ${page} +
                  '&size=' + ${size} +
                  '&filterCategory=' + ${currentCategory}}"
          method="post"
          enctype="multipart/form-data"
          th:object="${board}"
          class="post-form">

        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />


        <div class="form-group">
            <label>게시글 ID</label>
            <span th:text="*{id}" class="readonly-text"></span>
        </div>

        <div class="form-group">
            <label>작성자 닉네임</label>
            <span th:text="*{authorName}" class="readonly-text"></span>
        </div>

        <div class="form-group">
            <label>게시글 제목</label>
            <input type="text" th:field="*{title}" placeholder="제목을 입력하세요." />
        </div>

        <div class="form-group">
            <label>기사 제목</label>
            <span th:text="*{newsTitle}" class="readonly-text"></span>
        </div>

        <div class="form-group">
            <label>카테고리</label>
            <span th:text="*{newsCategory.name()}" class="readonly-text"></span>
            <input type="hidden" name="newsCategory" th:value="*{newsCategory.name()}" />
        </div>

        <div class="form-group">
            <label>내용</label>
            <textarea th:field="*{content}" rows="10" placeholder="내용을 입력하세요."></textarea>
        </div>

        <div class="form-group">
            <label>파일 첨부</label>
            <input type="file" name="files" multiple accept="image/*" onchange="showSelectedFiles(this)" />
            <div id="selectedFiles">
                <div th:if="${#lists.isEmpty(files)}">등록된 파일 없음</div>
                <ul th:if="${!#lists.isEmpty(files)}">
                    <li th:each="file : ${files}">
                        <span th:text="${file.fileName}"></span><br />
                        <img th:src="@{'/images/upload/' + ${file.serverFilename}}"
                             alt="첨부 이미지"
                             style="max-width: 150px; max-height: 150px; margin-top: 5px;" />
                    </li>
                </ul>
            </div>
        </div>

        <div class="form-group">
            <input type="checkbox" th:field="*{isBlind}" />
            <span>블라인드 처리</span>
        </div>



        <div class="form-actions">
            <button type="button"
                    class="cancel-btn"
                    th:attr="data-url=@{/admin/boards/list(page=${page}, size=${size}, category=${currentCategory})}"
                    onclick="location.href = this.dataset.url">
                취소
            </button>
            <button type="submit" class="submit-btn">수정</button>
            <button type="button" class="delete-btn" onclick="submitDeleteForm()">삭제</button>
        </div>
    </form>

    <form id="deleteForm" th:action="@{'/admin/boards/delete/' + ${board.id}}" method="post" style="display: none;">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
    </form>

</div>

<script>
    function submitDeleteForm() {
        if (confirm('정말로 이 게시글을 삭제하시겠습니까?')) {
            document.getElementById('deleteForm').submit();
        }
    }
  function showSelectedFiles(input) {
    const fileListDiv = document.getElementById('selectedFiles');
    fileListDiv.innerHTML = ''; // 기존 내용 지우기

    if (input.files.length > 0) {
      Array.from(input.files).forEach(file => {
        const p = document.createElement('p');
        p.textContent = file.name;
        fileListDiv.appendChild(p);
      });
    } else {
      fileListDiv.textContent = '등록된 파일 없음';
    }
  }
</script>

</body>
</html>
