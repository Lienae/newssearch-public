<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title th:text="${board.title}">게시글 제목</title>
  <link rel="stylesheet" href="/css/style.css" />
  <link rel="stylesheet" href="/css/border-detail.css" />
</head>
<body>
<div class="navbar">
  <a href="/main" class="logo">
    <img src="/img/NewsHub.png" alt="News Hub 로고" />
  </a>
  <nav>
    <a href="/news/list">뉴스</a>
    <a href="/boarder/list">커뮤니티</a>
  </nav>
  <div class="auth">
    <a href="/user/login">로그인</a>
    <a href="/user/register">회원가입</a>
  </div>
</div>

<div class="board-container">
  <h2 class="post-title" th:text="${board.title}">게시글 제목 예시</h2>

  <div class="post-info">
    <span>카테고리: <span th:text="${board.newsCategory}">POLITICS</span></span>
    <span>작성자 ID: <span th:text="${board.author.id}">101</span></span>
    <span>등록 일자: <span th:text="${#temporals.format(board.createdDate, 'yyyy-MM-dd')}">2025-07-01</span></span>
    <span>최근 수정일: <span th:text="${#temporals.format(board.modifiedDate, 'yyyy-MM-dd')}">2025-07-02</span></span>
  </div>

  <hr />

  <!-- 게시글 내용 -->
  <div class="post-content">

    <div class="post-content">
      <!-- attachFiles가 비어 있지 않을 경우에만 출력 -->
      <div th:if="${attachFiles != null and !#lists.isEmpty(attachFiles)}">
        <div th:each="file : ${attachFiles}">
          <img th:src="@{'/images/upload/' + ${file.serverFilename}}"
               alt="첨부 이미지"
               style="max-width: 100%; height: auto;"
               onerror="this.onerror=null; this.src='https://placehold.co/500x350';" />
        </div>
      </div>
    </div>

    <p th:utext="${board.content}">
      게시글의 본문 내용이 이곳에 표시됩니다. 사용자가 작성한 내용이 줄바꿈과 함께 자연스럽게 출력됩니다.
    </p>

    <!-- boarder-detail.html 에 적절한 위치에 추가 -->
    <div class="post-actions">
      <!-- loginUser와 board.author.id가 같으면 버튼 보이게 -->
      <th:block th:if="${loginUser != null and loginUser.id == board.author.id}">
        <a th:href="@{/boarder/edit/{id}(id=${board.id})}" class="btn btn-edit">수정</a>

        <form th:action="@{/boarder/edit/delete/{id}(id=${board.id})}" method="post" style="display:inline;">
          <button type="submit" class="btn btn-delete" onclick="return confirm('정말 삭제하시겠습니까?')">삭제</button>
        </form>
      </th:block>
    </div>



  </div>

  <hr />

  <div class="comment-section">
    <h3>총 <span th:text="${replyCount}">0</span>개의 의견</h3>
    <form class="comment-form" th:action="@{'/boarder/' + ${board.id} + '/reply'}" method="post"autocomplete="off">
      <input type="text" placeholder="의견을 작성해주세요." name="commentContent" required />
      <button type="submit">의견 등록</button>
    </form>
  </div>
  <div class="comment-list" >
    <div th:each="reply : ${replies}">

      <p>
        <strong th:text="${reply.member.name}">작성자</strong> |
        <span th:text="${#temporals.format(reply.createdDate, 'yyyy-MM-dd HH:mm')}">작성일</span>
      </p>
      <!-- 댓글 내용 (수정 전 상태) -->
      <div th:if="${not #lists.contains(editingReplies, reply.id)}" class="comment-item">
        <p class="comment-content" th:text="${reply.content}">댓글 내용</p>

        <!-- 수정/삭제 버튼 (본인만) -->
        <div th:if="${loginUser != null and loginUser.id == reply.member.id}" class="comment-actions">
          <form th:action="@{'/boarder/reply/editing/' + ${reply.id}}" method="post" style="display:inline">
            <input type="hidden" name="boardId" th:value="${board.id}" />
            <button type="submit" class="edit-btn">수정</button>
          </form>

          <form th:action="@{'/boarder/reply/' + ${reply.id} + '/delete'}" method="post"
                onsubmit="return confirm('정말 삭제하시겠습니까?');" style="display:inline">
            <button type="submit" class="delete-btn">삭제</button>
          </form>
        </div>
      </div>


      <!-- 수정 중일 때 보이는 폼 -->
      <div class="comment-section" th:if="${#lists.contains(editingReplies, reply.id)}">
        <form class="comment-form" th:action="@{'/boarder/reply/' + ${reply.id} + '/edit'}" method="post">
          <textarea name="content" rows="3" required th:text="${reply.content}"></textarea>
          <input type="hidden" name="boardId" th:value="${board.id}" />
          <button type="submit">수정 완료</button>
        </form>

      </div>

      <hr />


    </div>

  </div>



  <div class="post-buttons">
    <a href="/boarder/list" class="btn">목록으로</a>
  </div>


</div>
</body>
</html>
