<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>게시글 리스트</title>
  <link rel="stylesheet" href="/css/style.css" />
  <link rel="stylesheet" href="/css/boarder-list.css" />
  <link rel="stylesheet" href="/css/main.css" />
</head>
<body>
<header>
  <div th:replace="~{fragments/header :: header}"></div>
</header>

<div class="board-container">
  <div class="category-section">
    <div class="category-buttons">
      <a th:href="@{/board/list(category='ALL', filter=${filter})}" th:classappend="${category == null || category == 'ALL'} ? 'active'">전체</a>
      <a th:href="@{/board/list(category='POLITICS', filter=${filter})}" th:classappend="${category == 'POLITICS'} ? 'active'">정치</a>
      <a th:href="@{/board/list(category='ECONOMY', filter=${filter})}" th:classappend="${category == 'ECONOMY'} ? 'active'">경제</a>
      <a th:href="@{/board/list(category='SOCIAL', filter=${filter})}" th:classappend="${category == 'SOCIAL'} ? 'active'">사회</a>
      <a th:href="@{/board/list(category='CULTURE', filter=${filter})}" th:classappend="${category == 'CULTURE'} ? 'active'">문화</a>
      <a th:href="@{/board/list(category='SPORTS', filter=${filter})}" th:classappend="${category == 'SPORTS'} ? 'active'">스포츠</a>
      <a th:href="@{/board/list(category='MISC', filter=${filter})}" th:classappend="${category == 'MISC'} ? 'active'">기타</a>
    </div>



  </div>

  <div class="board-header">
    <div class="board-count">전체  <strong><span th:text="${totalVisibleBoards}">0</span></strong>건</div>
    <div th:if="${loginUser != null and loginUser.role.name() == 'ADMIN'}" class="editor-filter">
      <form method="get" action="/board/list">
        <input type="hidden" name="filter" value="admin">
        <button id="toggleFilterBtnEN" type="button">Editor's Note</button>

      </form>
    </div>

  </div>

  <table class="board-table">
    <thead>
    <tr>
      <th>번호</th>
      <th>제목</th>
      <th>등록일</th>
    </tr>
    </thead>
    <tbody>
      <tr th:each="board, stat : ${boardPage.content}">
        <td th:text="${boardPage.totalElements - (boardPage.number * boardPage.size + stat.index)}"></td>
        <td>
          <a th:href="@{'/board/detail/' + ${board.id}}"
             th:text="${board.title}"
             th:classappend="${board.isBlind} ? 'blind-title'">></a>
        </td>
        <td th:text="${#temporals.format(board.createdDate, 'yyyy-MM-dd')}"></td>
      </tr>
    </tbody>

  </table>

  <div class="pagination">
    <!-- 이전 페이지 버튼 -->
    <button th:if="${boardPage.hasPrevious()}"
            th:attr="data-url=@{/board/list(page=${boardPage.number - 1}, size=${pageSize}, category=${category})}"
            onclick="location.href=this.getAttribute('data-url')">
      «
    </button>
    <button th:unless="${boardPage.hasPrevious()}" disabled>«</button>

    <!-- 페이지 번호 버튼 -->
    <th:block>
      <button th:each="i : ${#numbers.sequence(0, boardPage.totalPages > 0 ? boardPage.totalPages - 1 : 0)}"
              th:text="${i + 1}"
              th:classappend="${i == boardPage.number} ? 'active'"
              th:attr="data-url=@{/board/list(page=${i}, size=${pageSize}, category=${category},, filter=${filter}, searchType=${searchType}, keyword=${keyword})}"
              onclick="location.href=this.getAttribute('data-url')">
      </button>
    </th:block>



    <!-- 다음 페이지 버튼 -->
    <button th:if="${boardPage.hasNext()}"
            th:attr="data-url=@{/board/list(page=${boardPage.number + 1}, size=${pageSize}, category=${category})}"
            onclick="location.href=this.getAttribute('data-url')">
      »
    </button>
    <button th:unless="${boardPage.hasNext()}" disabled>»</button>
  </div>


  <div class="board-search">
    <form method="get" action="/board/list">
      <select name="searchType">
        <option value="title" th:selected="${searchType} == 'title'">제목</option>
        <option value="content" th:selected="${searchType} == 'content'">내용</option>
      </select>
      <input type="text" name="keyword" th:value="${keyword}" placeholder="검색어를 입력해주세요." />
      <input type="hidden" name="category" th:value="${category}" />
      <input type="hidden" name="filter" th:value="${filter}" />
      <button type="submit">검색</button>
    </form>
  </div>

</div>

<script src="/js/board-list.js"></script>
</body>
</html>
